import pytest
import numpy as np
from app.services.malware_service import MalwareService

@pytest.fixture
def malware_service():
    return MalwareService(input_shape=(10,))

def test_malware_scan(malware_service):
    # Generate mock data
    mock_data = np.random.rand(100, 10)
    mock_labels = np.random.randint(2, size=100)
    
    # Train the model
    malware_service.train_model(mock_data, mock_labels)
    
    # Test data
    test_data = np.random.rand(10, 10)
    
    result = malware_service.scan_malware(test_data)
    assert 'threats' in result
    assert isinstance(result['threats'], list)
    assert all(0 <= threat <= 1 for threat in result['threats'])